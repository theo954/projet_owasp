-------------------------------------------------------------------------------------------------------/
Faille de sécurité : Exécution malveillante via pull_request_target dans GitHub Actions (“Pwn Request”)
-------------------------------------------------------------------------------------------------------/



Une vulnérabilité fréquente liée à l’utilisation de GitHub concerne la mauvaise configuration des workflows GitHub Actions, en particulier lors de l’usage de l’événement pull_request_target.



------------------------/
Description de la faille
------------------------/

L’événement pull_request_target permet d’exécuter un workflow dans le contexte du dépôt cible (le repository principal) lorsqu’une Pull Request est ouverte. Contrairement à l’événement pull_request, ce déclencheur donne accès aux secrets du dépôt ainsi qu’aux permissions associées au repository principal.

Le problème survient lorsque le workflow exécute du code provenant directement de la Pull Request (donc potentiellement contrôlé par un attaquant). Si une personne malveillante soumet une Pull Request depuis un fork, elle peut modifier des scripts (tests, build, etc.) afin d’exfiltrer des informations sensibles disponibles dans l’environnement d’exécution, comme :

Des secrets GitHub (tokens, clés API, secrets CI/CD)

Des identifiants de services tiers

Des clés de déploiement

Cette situation est communément appelée “Pwn Request”, car l’attaquant exploite la Pull Request pour compromettre l’environnement CI/CD.



-----------------------------/
Exemple de scénario d’attaque
-----------------------------/

Un dépôt possède un workflow configuré avec on: pull_request_target.

Le workflow fait un checkout du code de la Pull Request.

Il exécute un script du projet (tests, build ou script personnalisé).

Un attaquant modifie ce script dans sa Pull Request pour afficher ou envoyer les variables d’environnement contenant des secrets.

Le workflow s’exécute avec les permissions du dépôt principal et les secrets deviennent accessibles.

Le problème ne vient pas d’une faille intrinsèque de GitHub, mais d’une mauvaise configuration combinant :

L’événement pull_request_target

L’accès aux secrets

L’exécution de code non fiable



---------------------/
Mesures de mitigation
---------------------/


Pour réduire le risque :

Éviter d’exécuter du code provenant directement d’une Pull Request lorsque le workflow est déclenché par pull_request_target.

Utiliser plutôt l’événement pull_request si l’exécution du code de la PR est nécessaire.

Appliquer le principe du moindre privilège en configurant explicitement les permissions dans le workflow (permissions: contents: read par exemple).

Limiter l’accès aux secrets aux seuls workflows réellement nécessaires.

Mettre en place une validation manuelle avant l’exécution de workflows sensibles pour les contributions externes.

Une configuration rigoureuse des GitHub Actions est essentielle pour éviter ce type d’exploitation dans les environnements collaboratifs et open source.
